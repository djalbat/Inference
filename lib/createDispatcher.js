'use strict';

var createDispatcher = function createDispatcher(rule) {
  var listenersMap = {};

  var dispatch = function dispatch(action) {
    var resultsMap = rule(action),
        keys = Object.keys(resultsMap);

    keys.forEach(function (key) {
      var listeners = listenersMap[key];

      if (listeners) {
        var result = resultsMap[key];

        listeners.forEach(function (listener) {
          return listener(result);
        });
      }
    });
  };

  var subscribe = function subscribe(key, listener) {
    var listeners = listenersMap[key] || [];

    listeners.push(listener);

    listenersMap[key] = listeners;
  };

  var unsubscribe = function unsubscribe(key, l) {
    var listeners = listenersMap[key] || [];

    listeners = listeners.filter(function (listener) {
      return listener !== l;
    });

    if (listeners) {
      listenersMap[key] = listeners;
    } else {
      delete listenersMap[key];
    }
  };

  return { dispatch: dispatch, subscribe: subscribe, unsubscribe: unsubscribe };
};

module.exports = createDispatcher;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9jcmVhdGVEaXNwYXRjaGVyLmpzIl0sIm5hbWVzIjpbImNyZWF0ZURpc3BhdGNoZXIiLCJydWxlIiwibGlzdGVuZXJzTWFwIiwiZGlzcGF0Y2giLCJhY3Rpb24iLCJyZXN1bHRzTWFwIiwia2V5cyIsIk9iamVjdCIsImZvckVhY2giLCJrZXkiLCJsaXN0ZW5lcnMiLCJyZXN1bHQiLCJsaXN0ZW5lciIsInN1YnNjcmliZSIsInB1c2giLCJ1bnN1YnNjcmliZSIsImwiLCJmaWx0ZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxtQkFBbUIsU0FBbkJBLGdCQUFtQixDQUFDQyxJQUFELEVBQVU7QUFDakMsTUFBSUMsZUFBZSxFQUFuQjs7QUFFQSxNQUFNQyxXQUFXLFNBQVhBLFFBQVcsQ0FBQ0MsTUFBRCxFQUFZO0FBQzNCLFFBQU1DLGFBQWFKLEtBQUtHLE1BQUwsQ0FBbkI7QUFBQSxRQUNNRSxPQUFPQyxPQUFPRCxJQUFQLENBQVlELFVBQVosQ0FEYjs7QUFHQUMsU0FBS0UsT0FBTCxDQUFhLFVBQUNDLEdBQUQsRUFBUztBQUNwQixVQUFNQyxZQUFZUixhQUFhTyxHQUFiLENBQWxCOztBQUVBLFVBQUlDLFNBQUosRUFBZTtBQUNiLFlBQU1DLFNBQVNOLFdBQVdJLEdBQVgsQ0FBZjs7QUFFQUMsa0JBQVVGLE9BQVYsQ0FBa0IsVUFBQ0ksUUFBRDtBQUFBLGlCQUFjQSxTQUFTRCxNQUFULENBQWQ7QUFBQSxTQUFsQjtBQUNEO0FBQ0YsS0FSRDtBQVNELEdBYkQ7O0FBZUEsTUFBTUUsWUFBWSxTQUFaQSxTQUFZLENBQUNKLEdBQUQsRUFBTUcsUUFBTixFQUFtQjtBQUNuQyxRQUFNRixZQUFZUixhQUFhTyxHQUFiLEtBQXFCLEVBQXZDOztBQUVBQyxjQUFVSSxJQUFWLENBQWVGLFFBQWY7O0FBRUFWLGlCQUFhTyxHQUFiLElBQW9CQyxTQUFwQjtBQUNELEdBTkQ7O0FBUUEsTUFBTUssY0FBYyxTQUFkQSxXQUFjLENBQUNOLEdBQUQsRUFBTU8sQ0FBTixFQUFZO0FBQzlCLFFBQUlOLFlBQVlSLGFBQWFPLEdBQWIsS0FBcUIsRUFBckM7O0FBRUFDLGdCQUFZQSxVQUFVTyxNQUFWLENBQWlCLFVBQUNMLFFBQUQsRUFBYztBQUN6QyxhQUFRQSxhQUFhSSxDQUFyQjtBQUNELEtBRlcsQ0FBWjs7QUFJQSxRQUFJTixTQUFKLEVBQWU7QUFDYlIsbUJBQWFPLEdBQWIsSUFBb0JDLFNBQXBCO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsYUFBT1IsYUFBYU8sR0FBYixDQUFQO0FBQ0Q7QUFDRixHQVpEOztBQWNBLFNBQU8sRUFBRU4sa0JBQUYsRUFBWVUsb0JBQVosRUFBdUJFLHdCQUF2QixFQUFQO0FBQ0QsQ0F6Q0Q7O0FBMkNBRyxPQUFPQyxPQUFQLEdBQWlCbkIsZ0JBQWpCIiwiZmlsZSI6ImNyZWF0ZURpc3BhdGNoZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IGNyZWF0ZURpc3BhdGNoZXIgPSAocnVsZSkgPT4ge1xuICBsZXQgbGlzdGVuZXJzTWFwID0ge307XG5cbiAgY29uc3QgZGlzcGF0Y2ggPSAoYWN0aW9uKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0c01hcCA9IHJ1bGUoYWN0aW9uKSxcbiAgICAgICAgICBrZXlzID0gT2JqZWN0LmtleXMocmVzdWx0c01hcCk7XG5cbiAgICBrZXlzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgY29uc3QgbGlzdGVuZXJzID0gbGlzdGVuZXJzTWFwW2tleV07XG5cbiAgICAgIGlmIChsaXN0ZW5lcnMpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVzdWx0c01hcFtrZXldO1xuXG4gICAgICAgIGxpc3RlbmVycy5mb3JFYWNoKChsaXN0ZW5lcikgPT4gbGlzdGVuZXIocmVzdWx0KSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3Qgc3Vic2NyaWJlID0gKGtleSwgbGlzdGVuZXIpID0+IHtcbiAgICBjb25zdCBsaXN0ZW5lcnMgPSBsaXN0ZW5lcnNNYXBba2V5XSB8fCBbXTtcblxuICAgIGxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcblxuICAgIGxpc3RlbmVyc01hcFtrZXldID0gbGlzdGVuZXJzO1xuICB9O1xuXG4gIGNvbnN0IHVuc3Vic2NyaWJlID0gKGtleSwgbCkgPT4ge1xuICAgIGxldCBsaXN0ZW5lcnMgPSBsaXN0ZW5lcnNNYXBba2V5XSB8fCBbXTtcblxuICAgIGxpc3RlbmVycyA9IGxpc3RlbmVycy5maWx0ZXIoKGxpc3RlbmVyKSA9PiB7XG4gICAgICByZXR1cm4gKGxpc3RlbmVyICE9PSBsKTtcbiAgICB9KTtcblxuICAgIGlmIChsaXN0ZW5lcnMpIHtcbiAgICAgIGxpc3RlbmVyc01hcFtrZXldID0gbGlzdGVuZXJzO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgbGlzdGVuZXJzTWFwW2tleV07XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7IGRpc3BhdGNoLCBzdWJzY3JpYmUsIHVuc3Vic2NyaWJlIH07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZURpc3BhdGNoZXI7XG4iXX0=